[Репозиторий](https://github.com/captainKoala/Auth_sprint_2)

[Задачи](https://github.com/captainKoala/Auth_sprint_2/blob/main/tasks.md)

# Проектная работа 7 спринта


## Описание проекта

В проекте реализована основа сервиса авторизации, основной функционал которого описан ниже.


### API для сайта и личного кабинета

- регистрация пользователя;
- вход пользователя в аккаунт (обмен логина и пароля на пару токенов: JWT-access токен и refresh токен); 
- обновление access-токена;
- выход пользователя из аккаунта;
- изменение логина или пароля;
- получение пользователем своей истории входов в аккаунт;


### API для управления доступами

Управление ролями может осуществлять только пользователь, имеющий роль 'superuser'.
- CRUD для управления ролями:
  - создание роли,
  - удаление роли,
  - изменение роли,
  - просмотр всех ролей.
- назначить пользователю роль;
- отобрать у пользователя роль. 


### Авторизация

Возможны два способа аутентификации пользователей в сервисе Auth:
- в обмен на email/пароль предоставляется пара JWT-токенов
- авторизация через сторонние сервисы (ВК, Яндекс)
JWT-токены помимо стандартных полей в payload содержат идентификатор пользователя (user) и список его ролей (roles).


### Интеграция сервисов

Для демонстрации возможности интеграции сервисов в сервис OpenAPI (fastapi) реализована авторизация по JWT с его расшифровкой.
Для пользователей с привелигированными ролями (`'superuser'`, `'gold_user'`, `'volunteer'`) эндпоинт films предоставляет 
информацию по всем фильмам, для обычных пользователей только по 3.


### Ограничение количества запросов

У сервиса реализовано ограничение по количеству запросов, которое задается переменной окружения `AUTH_REQUESTS_LIMITS` 
(формат: _значения количество_запросов/единица_времени_, разделенные запятой), например:
```commandline
250/day,50/minute
```

### Трассировка
1. Для запуска Jaeger запустите сервис jaeger
```commandline
docker-compose up --build jaeger
```
2. Перейдите на страницу [http://127.0.0.1:16686/](http://127.0.0.1:16686/)


## Документация

Документация к API расположена на странице [http://127.0.0.1:5000/auth/docs/](http://127.0.0.1:5000/auth/docs/){target="_blank"}.


## Подготовка проекта

1. Задайте переменные окружения в файле `.env` в корне проекта (пример в файле `.env.example`).
2. Запустите проект с помощью команды:
```commandline
docker-compose up --build
```

**При запуске проекта будут созданы группа пользователей _superuser_ и суперпользователь (если его email и пароль были
заданы соответствующими переменными окружения).**  


## Запуск тестов

1. Для запуска тестов вам так же потребуется задать переменные окружения (можно поместить файл `.env` в директорию 
`tests_auth`).
2. Перейдите в директорию `tests_auth` и запустите тесты:
```commandline
cd tests_auth/
docker-compose up --build tests
```

## Использованные технологии

- FastAPI
- Flask 
- SQLAlchemy
- PostgreSQL
- ElasticSearch
- Redis
- Pytest


## Над проектом работали

- Алексей Белоглазов [@AlexeyBely](https://github.com/AlexeyBely)
- Константин Паулкин [@captainKoala](https://github.com/captainKoala)
